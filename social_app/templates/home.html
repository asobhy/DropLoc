{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
{% load static %}
<br>
    <div class="row">
      <div class="col-3">
        {% include 'snippets/left-menu.html' %}
      </div>
      <div class="col-6" id="postlistid">
        {% include 'home_main_content.html' %}
        
        {% for i in post_list %}
        <br>
        <div class="card p-3">
          <div class="d-flex flex-row justify-content-between align-items-center">
            <div class="d-flex flex-row">
              <img class="pe-1 profile-pic" src="{{ i.user.profile_image.url }}" alt="" srcset="">
              <div class="d-flex flex-column">
                <span style="font-size: 14px; font-weight: bold;">{{ i.user.username }}</span>
                <span style="font-size: 11px; color: gray;">{{ i.date_post }} Ago</span>
              </div>
            </div>
            <div class="d-flex flex-row">
              
            </div>
          </div>
          <br>
          <div class="w-100" id="post">
            <p>{{ i.user_post }}</p>
          </div>
          <div id="postimage">
            {% if i.image %}
            <img class="w-100" src="{{ i.image.url }}" alt="" srcset="">
            {% endif %}
          </div>
          <hr>
          <div class="d-flex flex-row justify-content-between align-items-center">
           <div class="d-flex flex-row align-items-center">
            <a href="#" class="likesstyle" id="likecountid" data-id="{{ i.id }}">
            
          </a>
           </div>
           <div>
            <a href="#">
              <span class="text-secondary">5 comments</span>
            </a>
           </div>
          </div>
          <hr>
            <div class="d-flex flex-row justify-content-between">
              <div class="d-flex flex-row align-items-center justify-content-center w-50 likecommentshare" id="likeidBtn" data-id="{{ i.pk }}">
                <i class="fa-solid fa-thumbs-up p-1"></i>
                <span>Like</span>
              </div>
            <div class="d-flex flex-row align-items-center justify-content-center w-50 likecommentshare" id="commentidBtn" data-id="{{ i.pk }}">
              <i class="fa-regular fa-comment p-1"></i>
              <span>Comment</span>
            </div>
            <div class="d-flex flex-row align-items-center justify-content-center w-50 likecommentshare" id="shareidBtn">
              <i class="fa-solid fa-share p-1"></i>
              <span>Share</span>
            </div>
            </div>
          <hr>
          <div class="commentcontainer" id="commentcontainerid">
            <img class="pe-1 profile-pic" src="{{ i.user.profile_image.url }}" alt="" srcset="">
            <textarea name="" placeholder="Write a comment..." id="commentinput"></textarea>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="col-3">
        <div class="card">
            <h1>hello</h1>
        </div>
      </div>
    </div>


    
<script>

  var url = window.location.origin
  //var pk = 
  const commentidBtn = [...document.querySelectorAll('#commentidBtn')]
  const commentcontainerId = [...document.querySelectorAll('#commentcontainerid')].reverse()
  const likecountId = [...document.querySelectorAll('#likecountid')].reverse() 
  const likeidBtn = [...document.querySelectorAll('#likeidBtn')]

  UserlikeCount()


// <!-----------------  Script to get user like counts --------->

  function UserlikeCount(){
    fetch(`${url}/like-count/`, {
      body: null,
      method: "GET"
    }).then((res) => res.json()).then((data) =>{
      console.log(data)
    })
  }

// ---------------------------------------------------------------------- -->



// ---------------Script for user to like post -------------------------------->
  
    likeidBtn.forEach(likeBtn => likeBtn.addEventListener('click', (e) =>{
      var id = likeBtn.getAttribute('data-id')
      var elementId = id - 1
      console.log(elementId)
      fetch(`${url}/like-post/${id}/`, {
        body: null,
        method: 'POST'
      }).then((res) => res.json()).then((data) =>{
        console.log(data)
        likecountId[elementId].innerHTML = `
        <i class="fa-solid fa-thumbs-up text-white text-bg-primary p-1 rounded-pill"></i>
            <span class="ps-1" style="color: black; text-decoration-line: none;">${data.like_count}</span>
        `
      })
    }))

//--------------------------------------------------------------------------- -->




// ------------Script to display comment Input ---------------->

  commentidBtn.forEach(comBtn=> comBtn.addEventListener('click', (e) =>{
      e.preventDefault()
      var id = (comBtn.getAttribute('data-id') - 1)
      commentcontainerId[id].classList.add('d-flex')
      commentcontainerId[id].classList.add('flow-row')
  }))

//------------------------------------------------------------------ -->


</script>
  
{% endblock %}