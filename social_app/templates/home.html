{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
{% load static %}
<br>
    <div class="row">
      <div class="col-3">
        {% include 'snippets/left-menu.html' %}
      </div>
      <div class="col-6" id="postlistid">
        {% include 'home_main_content.html' %}
        
        {% for i in post_list %}
        <br>
        <div class="card p-3">
          <div class="d-flex flex-row justify-content-between align-items-center">
            <div class="d-flex flex-row">
              <img class="pe-1 profile-pic" src="{{ i.user.profile_image.url }}" alt="" srcset="">
              <div class="d-flex flex-column">
                <span style="font-size: 14px; font-weight: bold;">{{ i.user.username }}</span>
                <span style="font-size: 11px; color: gray;">{{ i.date_post }} Ago</span>
              </div>
            </div>
            <div class="d-flex flex-row">
              
            </div>
          </div>
          <br>
          <div class="w-100" id="post">
            <p>{{ i.user_post }}</p>
          </div>
          <div id="postimage">
            {% if i.image %}
            <img class="w-100" src="{{ i.image.url }}" alt="" srcset="">
            {% endif %}
          </div>
          <hr>
          <div class="d-flex flex-row justify-content-between align-items-center">
           <div class="d-flex flex-row align-items-center">
            <a href="#" class="likesstyle" id="likecountid" data-id="{{ i.id }}">
              
          </a>
           </div>
           <div>
            <a href="#" id="commentcountid" data-id="{{ i.id }}">
              
            </a>
           </div>
          </div>
          <hr>
            <div class="d-flex flex-row justify-content-between">
              <div class="d-flex flex-row align-items-center justify-content-center w-50 likecommentshare" id="likeidBtn" data-id="{{ i.pk }}">
                <i class="fa-solid fa-thumbs-up p-1"></i>
                <span>Like</span>
              </div>
            <div class="d-flex flex-row align-items-center justify-content-center w-50 likecommentshare" id="commentidBtn" data-id="{{ i.pk }}">
              <i class="fa-regular fa-comment p-1"></i>
              <span>Comment</span>
            </div>
            <div class="d-flex flex-row align-items-center justify-content-center w-50 likecommentshare" id="shareidBtn">
              <i class="fa-solid fa-share p-1"></i>
              <span>Share</span>
            </div>
            </div>
          <hr>
          <div class="commentcontainer" id="commentcontainerid">
            <img class="pe-1 profile-pic" src="{{ i.user.profile_image.url }}" alt="" srcset="">
            <textarea name="" placeholder="Write a comment..." id="commentinput" data-pk="{{ i.pk }}"></textarea>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="col-3">
        <div class="card">
            <h1>hello</h1>
        </div>
      </div>
    </div>


    
<script>

  var url = window.location.origin
  //var pk = 
  const commentidBtn = [...document.querySelectorAll('#commentidBtn')]
  const commentcontainerId = [...document.querySelectorAll('#commentcontainerid')].reverse()
  const likecountId = [...document.querySelectorAll('#likecountid')].reverse() 
  const likeidBtn = [...document.querySelectorAll('#likeidBtn')]
  const commentInput = [...document.querySelectorAll('#commentinput')]
  const commentcountId = [...document.querySelectorAll('#commentcountid')]
  const commentcountIdReverse = [...document.querySelectorAll('#commentcountid')].reverse()
  


// <!-----------------  Script to get user like counts --------->

  UserlikeCount()
  function UserlikeCount(){
    likecountId.forEach((likCount) =>{
      var pkhdh = likCount.getAttribute('data-id')
      fetch(`${url}/get-like-count/${pkhdh}/`, {
      body: null,
      method: "GET"
    }).then((res) => res.json()).then((data) =>{
      likCount.innerHTML += `
              <i class="fa-solid fa-thumbs-up text-white text-bg-primary p-1 rounded-pill"></i>
              <span class="ps-1" style="color: black; text-decoration-line: none;">${data['like_count']}</span>
      ` 
    })
    })
    
  }

// --------------------------- END ------------------------------------------- -->



// ---------------Script for user to like a post -------------------------------->
  
    likeidBtn.forEach(likeBtn => likeBtn.addEventListener('click', (e) =>{
      var id = likeBtn.getAttribute('data-id')
      var elementId = id - 1
      fetch(`${url}/like-post/${id}/`, {
        body: null,
        method: 'POST'
      }).then((res) => res.json()).then((data) =>{
        likecountId[elementId].innerHTML = `
              <i class="fa-solid fa-thumbs-up text-white text-bg-primary p-1 rounded-pill"></i>
              <span class="ps-1" style="color: black; text-decoration-line: none;">${data['like_count']}</span>
        `
      })
      
    }))

//----------------------------- END ---------------------------------------------- -->




// ------------Script to display comment Input textarea ---------------->

  commentidBtn.forEach(comBtn=> comBtn.addEventListener('click', (e) =>{
      e.preventDefault()
      var idNum = (comBtn.getAttribute('data-id') - 1)
      commentcontainerId[idNum].classList.add('d-flex')
      commentcontainerId[idNum].classList.add('flow-row')
  }))

//--------------------------- END --------------------------------------- -->




// --------------- User comment on a post ----------------------------- -->

      commentInput.forEach(comInput=> comInput.addEventListener('keyup', (e)=>{
        e.preventDefault()
        var commentPk = comInput.getAttribute('data-pk')
        var elementId = comInput.getAttribute('data-pk') - 1
        var inputValue = e.target.value.trim()
        if(e.key === 'Enter'){
          fetch(`${url}/user-comment/${commentPk}/`, {
            body: JSON.stringify({
              inputValue: inputValue
            }),
            method: 'POST'
          }).then((res) => res.json()).then((data) =>{
            commentcountIdReverse[elementId].innerHTML = `<span class="text-secondary">${data['comment_count']} comments</span>`
          })
          comInput.value = ""
        }
      }))
      

// --------------------- END ------------------------------------------ -->




  // <---------------------- Script to get user comments ------------------->
  
  commentCount()
  function commentCount(){
    commentcountId.forEach((countId) =>{
      var getId = countId.getAttribute('data-id')
      fetch(`${url}/comment-count/${getId}/`, {
        body: null,
        method: 'GET'
    }).then((res) => res.json()).then((data) =>{
        countId.innerHTML += `<span class="text-secondary">${data['response']} comments</span>`
      })
    }) 
  }

// <------------------------ END ------------------------------------------->


</script>
  
{% endblock %}